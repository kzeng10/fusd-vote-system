<!DOCTYPE html>
<html lang='en'>
	<head>
		<meta charset='utf-8'>
		<meta http-equiv='X-UA-Compatible' content = 'IE=edge'>
		<meta name='viewport' content='width=device-width, initial-scale=1'>
		<meta name='author' content='Kevin Zeng'>
		<title>FUSD Voting System</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script>
			// var interval;
			// var power = false;
			//here we get new content and update html
			var HttpClient = function() {
			    this.get = function(aUrl, aCallback) {
			        var anHttpRequest = new XMLHttpRequest();
			        anHttpRequest.onreadystatechange = function() { 
			            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
			                aCallback(anHttpRequest.responseText);
			        }

			        anHttpRequest.open( "GET", aUrl, false );            
			        anHttpRequest.send( null );
			        // setTimeout(get, 1000);
			    }
			}
			var update = function() {
				var aClient = new HttpClient();
				var yes = "";
				var no = "";
				aClient.get('/json', function(answer) {
					var response = $.parseJSON(answer);
					var speak = response['speak'];
					var quiet = response['quiet'];
					for(var i = 0; i<speak.length; i++) {
						yes = yes.concat('<li>' + speak[i] + '</li>');
					}
					if(speak.length === 0) {
						yes = "<li>No one!</li>";
					}
					for(var i = 0; i<quiet.length; i++) {
						no = no.concat('<li>' + quiet[i] + '</li>');
					}
					if(no === "") {
						no = "<li>No one!</li>";
					}
					$('#yes').html(yes);
					$('#no').html(no);
				});
			}
			$(document).ready(function(){
				var interval;
				var power = false;
				$('#power').click(function() {
					if(power){
						power = false;
						$('#power-ind').text('Off');
						clearInterval(interval);
					}
					else{
						//start it up again
						power = true;
						$('#power-ind').text('On');
						interval = setInterval(update, 3000);
						// clearInterval(interval);
					}
				});
			});
		</script>
	</head>
	<body>
		<h1>Admin Page</h1>
		<p><button id='power'>Power</button><div id='power-ind'>Off</div></p>
		<form method='post'>
			<div id='input'></div>
			 <input type='submit' value='Reset'>
			 <br>
			 <p>These people wish to speak</p>
			 <ul id='yes'>No one!</ul>
			 <p>These people wish to remain quiet</p>
			 <ul id='no'>No one!</ul>
		</form>
	</body>
</html>